---
title: "MLR Models for Sale Price of GTA Homes"
output: github_document
---

## I. Data Wrangling

```{r, echo=FALSE, message=FALSE}
library(tidyverse)
data_ay5991 <- read_csv('real203.csv')
set.seed(1005165991)
homes_ay5991 <- sample_n(data_ay5991, 150)
homes_ay5991 <- homes_ay5991 %>%
  mutate(lotsize=lotlength*lotwidth) %>%
  select(-c(lotlength, lotwidth))
homes_ay5991$ID
```

```{r, include=FALSE}
# Find number of na values in maxsqfoot column
sum(is.na(homes_ay5991$maxsqfoot))
homes_ay5991 <- homes_ay5991 %>%
  select(-maxsqfoot) %>%
  drop_na()
attach(homes_ay5991)
```

We remove the maxsqfoot variable because for 87 of our 150 observations, we don't have this information. Similarly, we remove 10 additional data points that have some missing value for at least one of the variables, so we are able to perform stepwise regression later, which requires that we don't have missing values.

## II. Exploratory Data Analysis

Categorical Variables: location
Discrete Variables: bedroom, bathroom, parking
Continous Variables: sale, list, taxes, lotsize

```{r, echo=FALSE}
homes_ay5991_numeric <- select(homes_ay5991, -c(ID, location))
cor(homes_ay5991_numeric)
pairs(homes_ay5991_numeric)
title(sub='(5991)')
```

We see from the correlation matrix that the correlations between sale price and each of the potential numeric predictors are from strongest to weakest: list, taxes, bathroom, bedroom, lotsize, parking.

Of these potential predictors, we can see from the scatterplot matrix, that because number of bathrooms is a discrete variable, the plot of sale price against number of bathrooms has for each value of number of bathrooms, multiple instances of homes with different sale prices. From the plot, we can see that the spread of these instances for each value of number of bathrooms does not appear to be constant. We can confirm this by plotting the residuals against the fitted values for an SLR model with number of bathrooms as the sole predictor.

```{r, echo=FALSE}
plot(lm(sale~bathroom), 1, sub='(5991)')
```

## III. Methods and Model

```{r, echo=FALSE}
mod_ay5991 <- lm(sale~list+taxes+bathroom+bedroom+lotsize+parking+location)
# Get values for coefficient estimates and p-values for table
table_ay5991 <- data.frame(summary(mod_ay5991)[["coefficients"]][,c(1,4)])
table_ay5991[2] <- round(table_ay5991[2], 4)
names(table_ay5991)[2] <- 'P_Value (5991)'
table_ay5991
```

For each of our predictor variables, if the corresponding p-value is statistically significant, holding the other predictors constant, we assume that as our predictor increases by one unit, our predicted mean sale price would increase by the corresponding estimate.

```{r, include=FALSE}
step(mod_ay5991, direction = "backward")
bic_mod_ay5991 <- step(mod_ay5991, direction = "backward", k=log(150))
```

We have that the final fitted model when backwards elimination is used with AIC is:  
predicted mean sale price = 109177.5 + 0.8498292(list) + 20.60792(taxes) + -11204.72(parking) + 82851.77(location)  
and when BIC is used:  
predicted mean sale price = 66268.78 + 0.8438852(list) + 19.57671(taxes) + 123410.4(location),  
where location is a dummy variable equal to 1 when the location is Toronto and 0 otherwise

All three of our considered models used a different set of predictor variables. This is because we included all of our numeric variables in our first model, but the latter two methods arrived at a smaller subset in an attempt to prevent overfitting. This is also why our BIC model has fewer predictor variables than our AIC model, as this method punishes model complexity to a greater extent when we have this many data points.

## IV. Discussions and Limitations

```{r, echo=FALSE}
par(mfrow=c(2,2))
plot(bic_mod_ay5991)
title(sub='(5991)')
```

We see from the first and third plots that we appear to have constant error variance, as the residuals do not seem to exhibit some sort of particular pattern. The residuals also trend the line in the normal Q-Q plot quite well. In the last plot, we see that point 134 is a point of high leverage, so this point can be investigated further.

The next step towards arriving at a valid model involves comparing the three models we've fitted. There do not appear to be any violations of the model assumptions for our BIC model, but we should check these assumptions for our other two models as well. We can then assess the effect of each predictor variable on sale price, given the effects of the other predictor variables, with added variable plots and assess the collinearity among the predictor variables with variance inflation factors. Once we have our set of viable models, we can further compare the adjusted R-squared and predictive abilities of each model to choose the best one.